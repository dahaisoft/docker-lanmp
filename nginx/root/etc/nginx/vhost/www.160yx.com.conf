server {
    listen 80;
    server_name www2.160yx.com;
    root  /var/www/html/www.160yx.com-test;
    #access_log on;
    #access_log /fjyl/logs/nginx/www.59yx.com-access.log access;
    #error_log /fjyl/logs/nginx/www.59yx.com-error.log;
    index index.html index.htm index.php default.html default.htm default.php;

    location ~ \.php$ {
                fastcgi_pass   192.168.99.100:9000;
                fastcgi_index  index.php;
                fastcgi_split_path_info       ^(.+\.php)(.*)$;
                fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
                fastcgi_param PATH_INFO       $fastcgi_path_info;
                #fastcgi_index  index.php;
                include        fastcgi_params;
    }

    location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$ {
            expires      30d;
    }
    location ~ .*\.(js|css)?$ {
            expires      12h;
    }
    location ~ .*.(svn) {
        deny all;
    }
    location ~ /.ht {
       deny all;
     }
    location / {
        set $flag 0;
        if (!-f $request_filename) {
            set $flag "${flag}1";
        }
        if ($request_filename ~ ^(\/var\/www\/html\/www.160yx.com-test\/[\w]+)/.*) {
            set $flag "${flag}2";
            set $dirname $1;
        }
        if (-d $dirname) {
            set $flag "${flag}3";
        }
        if ($flag = 0123) {
            rewrite  ^/([\w]+)/(.*)$  /$1/index.php?s=$2  last;
        }
        
        if (!-e $request_filename) {
            rewrite  ^/app.php/(.*)/(.*)/*$  /app.php?m=$1&a=$2  last;
            
            rewrite  ^(.*)$  /index.php?s=$1&abc_$flag  last;
            break;
        }
    }

}
